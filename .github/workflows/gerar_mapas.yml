name: Gerar Mapas ECMWF

on:
  workflow_dispatch: # permite rodar manualmente no Actions
  schedule:
    - cron: "0 11 * * *" # roda todo dia √†s 08:00 BRT (11 UTC)

permissions:
  contents: write  # üîë permite que o bot publique na branch gh-pages

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Clona o reposit√≥rio
      - name: Checkout do c√≥digo
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Instala depend√™ncias do sistema
      - name: Instalar depend√™ncias do sistema
        run: |
          sudo apt-get update
          sudo apt-get install -y libeccodes0 libproj-dev proj-data proj-bin libgeos-dev

      # 3Ô∏è‚É£ Instala pacotes Python
      - name: Instalar depend√™ncias Python
        run: |
          python -m pip install --upgrade pip
          pip install ecmwf-opendata cartopy cfgrib eccodes xarray matplotlib numpy pandas

      # 4Ô∏è‚É£ Executa o script Python
      - name: Gerar mapas ECMWF
        run: python gerar_mapas.py

      # 5Ô∏è‚É£ Publica os mapas na branch gh-pages
      - name: Publicar no GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./mapas
          publish_branch: gh-pages
          force_orphan: true
          user_name: github-actions
          user_email: github-actions@github.com
